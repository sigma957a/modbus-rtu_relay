# üìã –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Modbus RTU Relay –∫ RPI5 —á–µ—Ä–µ–∑ Ethernet Gateway

## üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 2024  
**–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:**
- Raspberry Pi 5 (RPI5)
- Waveshare 4-CH RS485 TO POE ETH (B) - Modbus Gateway
- Waveshare Modbus RTU Relay 32CH

**–¶–µ–ª—å:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 32-–∫–∞–Ω–∞–ª—å–Ω—ã–º Modbus RTU —Ä–µ–ª–µ —á–µ—Ä–µ–∑ Ethernet Gateway —Å RPI5

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üíª –®–∞–≥ 0: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RPI5 —á–µ—Ä–µ–∑ SSH

### 0.1 –ë–∞–∑–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ SSH

**–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```bash
ssh sigma@rpi5
```

**–ò–ª–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º IP –∞–¥—Ä–µ—Å–∞:**
```bash
ssh sigma@192.168.0.100
```

**–ì–¥–µ:**
- `sigma` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ RPI5
- `rpi5` - hostname (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `/etc/hosts` –∏–ª–∏ SSH config)
- `192.168.0.100` - IP –∞–¥—Ä–µ—Å RPI5 (–µ—Å–ª–∏ hostname –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

### 0.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH config (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSH config –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

**–°–æ–∑–¥–∞–π—Ç–µ/–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `~/.ssh/config`:**
```bash
nano ~/.ssh/config
```

**–î–æ–±–∞–≤—å—Ç–µ:**
```
Host rpi5
    HostName 192.168.0.100
    User sigma
    IdentityFile ~/.ssh/id_rsa
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ:**
```bash
ssh rpi5
```

### 0.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
pwd

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
ip addr show

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Gateway
ping 192.168.1.254

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python –æ–∫—Ä—É–∂–µ–Ω–∏—è
which python3
python3 --version
```

### 0.4 –†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–µ–∫—Ç–æ–º –Ω–∞ RPI5

**–ü–æ—Å–ª–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd ~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source bot_env/bin/activate

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
pip list | grep -E "pymodbus|minimalmodbus"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
ls -la app/vending_ui/
```

### 0.5 SSH —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É Gateway

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway —Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞:**

**–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Mac/Linux):**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ SSH —Ç—É–Ω–Ω–µ–ª—å
# –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç 8080 –Ω–∞ –ø–æ—Ä—Ç 80 (–∏–ª–∏ 25) Gateway —á–µ—Ä–µ–∑ RPI5
ssh -L 8080:192.168.1.254:80 sigma@rpi5

# –ï—Å–ª–∏ Gateway –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 25 –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
# ssh -L 8080:192.168.1.254:25 sigma@rpi5

# –¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# http://localhost:8080
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** 
- –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É Gateway –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å
- –û–±—ã—á–Ω–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 80, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø–æ—Ä—Ç 25
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Gateway –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞

**–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É Gateway —á–µ—Ä–µ–∑ RPI5:**
```bash
# –ù–∞ RPI5 (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –±—Ä–∞—É–∑–µ—Ä)
firefox http://192.168.1.254
# –∏–ª–∏
chromium-browser http://192.168.1.254
```

### 0.6 –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ RPI5

**–° –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –Ω–∞ RPI5:**
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
scp /path/to/file.py sigma@rpi5:~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5/

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
scp -r /path/to/directory sigma@rpi5:~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5/

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
scp .env sigma@rpi5:~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5/.env
```

**–° RPI5 –Ω–∞ –≤–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä:**
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
scp sigma@rpi5:~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5/file.py /path/to/destination/
```

### 0.7 –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –Ω–∞ RPI5 –±–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤—Ö–æ–¥–∞

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã:**
```bash
ssh sigma@rpi5 "cd ~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5 && source bot_env/bin/activate && python3 app/vending_ui/run_relay.py status"
```

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–∞–Ω–¥:**
```bash
ssh sigma@rpi5 << 'EOF'
cd ~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5
source bot_env/bin/activate
python3 app/vending_ui/test_relay_sequence.py
EOF
```

---

## üì∏ –§–æ—Ç–æ 1: –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ:**
–ù–∞ —Ñ–æ—Ç–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞ –æ–±—â–∞—è —Å—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
- RPI5 —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º Ethernet –∫–∞–±–µ–ª–µ–º
- Waveshare Gateway (—á–µ—Ä–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ) —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏:
  - PWR (–∫—Ä–∞—Å–Ω—ã–π LED) - –≥–æ—Ä–∏—Ç
  - NET (—Å–µ—Ç–µ–≤–æ–π LED) - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
  - LINK1, LINK2, LINK3, LINK4 (—Å–∏–Ω–∏–µ LED) - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤
- Waveshare Modbus RTU Relay 32CH —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–≤–æ–¥–∞–º–∏ RS485
- –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 12V –¥–ª—è —Ä–µ–ª–µ
- –ü—Ä–æ–≤–æ–¥–∞ RS485 –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ Port 1 Gateway (RS485-1)

**–ü–æ–¥–ø–∏—Å–∏ –Ω–∞ —Ñ–æ—Ç–æ:**
```
RPI5 (Ethernet) ‚îÄ‚îÄ‚îÄ‚îÄ> [Switch/Router] ‚îÄ‚îÄ‚îÄ‚îÄ> Gateway (PoE ETH)
                                                      ‚îÇ
                                                      ‚îî‚îÄ‚îÄ‚îÄ> RS485-1 ‚îÄ‚îÄ‚îÄ‚îÄ> Modbus Relay 32CH
```

---

## üîå –®–∞–≥ 1: –§–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### 1.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Gateway –∫ —Å–µ—Ç–∏

**–§–æ—Ç–æ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Ethernet –∫ Gateway**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- Ethernet –∫–∞–±–µ–ª—å –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ø–æ—Ä—Ç—É "POE ETH" –Ω–∞ Gateway
- –ö–∞–±–µ–ª—å –∏–¥–µ—Ç –æ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–∞ –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –æ—Ç RPI5
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä NET –Ω–∞ Gateway –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ù–∞ RPI5 –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
ip addr show eth0

# –ï—Å–ª–∏ Gateway –≤ –¥—Ä—É–≥–æ–π –ø–æ–¥—Å–µ—Ç–∏, –¥–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π IP
sudo ip addr add 192.168.1.100/24 dev eth0
```

### 1.2 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–ª–µ –∫ Gateway

**–§–æ—Ç–æ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ RS485 –∫ Port 1**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ù–∞ —Ñ–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ:
- Gateway —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –∫–ª–µ–º–º–∞–º–∏ RS485-1
- –ü—Ä–æ–≤–æ–¥–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –∫–ª–µ–º–º–∞–º:
  - **–ñ–µ–ª—Ç—ã–π –ø—Ä–æ–≤–æ–¥** ‚Üí B- (RS485-1)
  - **–ó–µ–ª–µ–Ω—ã–π –ø—Ä–æ–≤–æ–¥** ‚Üí A+ (RS485-1)
  - **GND** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ü—Ä–æ–≤–æ–¥–∞ –∏–¥—É—Ç –∫ Modbus Relay 32CH

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- **A+ —Ä–µ–ª–µ ‚Üí A+ Gateway (Port 1)**
- **B- —Ä–µ–ª–µ ‚Üí B- Gateway (Port 1)**
- **GND —Ä–µ–ª–µ ‚Üí GND Gateway (Port 1)** (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ü—Ä–æ–±–ª–µ–º–∞ #1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–ª—è—Ä–Ω–æ—Å—Ç—å RS485**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –†–µ–ª–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- LINK1 –Ω–µ –º–æ—Ä–≥–∞–µ—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥
- –ö–æ–º–∞–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è, –Ω–æ —Ä–µ–ª–µ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–º–µ–Ω—è–π—Ç–µ –º–µ—Å—Ç–∞–º–∏ –ø—Ä–æ–≤–æ–¥–∞ A+ –∏ B-
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –Ω–µ –ø–æ–≤—Ä–µ–¥–∏—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
- –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–æ–ª—è—Ä–Ω–æ—Å—Ç–∏ LINK1 –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∞—Ç—å –º–æ—Ä–≥–∞—Ç—å –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥

### 1.3 –ü–∏—Ç–∞–Ω–∏–µ —Ä–µ–ª–µ

**–§–æ—Ç–æ 4: –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è —Ä–µ–ª–µ**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 12V –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Ä–µ–ª–µ
- –ü—Ä–æ–≤–æ–¥–∞ –ø–∏—Ç–∞–Ω–∏—è: V+ (–∫—Ä–∞—Å–Ω—ã–π) –∏ V- (—á–µ—Ä–Ω—ã–π/—Å–∏–Ω–∏–π)
- –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∏—Ç–∞–Ω–∏—é:**
- **–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ:** 12V DC (–¥–∏–∞–ø–∞–∑–æ–Ω 7-36V)
- **–¢–æ–∫:** –º–∏–Ω–∏–º—É–º 1.5A, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2A
- **–ú–æ—â–Ω–æ—Å—Ç—å:** –º–∏–Ω–∏–º—É–º 18W, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 24W

**–ü—Ä–æ–±–ª–µ–º–∞ #2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –†–µ–ª–µ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- –†–µ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ
- –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è –ø–µ—Ä–µ–≥—Ä–µ–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 5V (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!)
- –ó–∞–º–µ–Ω–µ–Ω –Ω–∞ –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 12V, 60W
- –ü–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã —Ä–µ–ª–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ

---

## ‚öôÔ∏è –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gateway

### 2.1 –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

**–§–æ—Ç–æ 5: –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –û—Ç–∫—Ä—ã—Ç –±—Ä–∞—É–∑–µ—Ä —Å –∞–¥—Ä–µ—Å–æ–º `http://192.168.1.254`
- –í–∏–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≤ Gateway
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–∞—Ä–æ–ª—è –Ω–µ—Ç (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ RPI5 –∏–ª–∏ —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å
2. –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å: `http://192.168.1.254`
3. –ù–∞–∂–º–∏—Ç–µ "Login" (–ø–∞—Ä–æ–ª—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

**–ü—Ä–æ–±–ª–µ–º–∞ #3: –ù–µ –º–æ–≥—É –æ—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Gateway
- Timeout –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–†–µ—à–µ–Ω–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å:**
   ```bash
   ping 192.168.1.254
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –æ–¥–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏:**
   ```bash
   # –ï—Å–ª–∏ Gateway –Ω–∞ 192.168.1.254, –∞ RPI5 –Ω–∞ 192.168.0.x
   sudo ip addr add 192.168.1.100/24 dev eth0
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH —Ç—É–Ω–Ω–µ–ª—å:**
   ```bash
   # –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
   # –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç 8080 –Ω–∞ –ø–æ—Ä—Ç 80 Gateway —á–µ—Ä–µ–∑ RPI5
   ssh -L 8080:192.168.1.254:80 sigma@rpi5
   # –ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080
   ```
   
   **‚ö†Ô∏è –í–∞–∂–Ω–æ:** –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É Gateway –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç 8080 –Ω–∞ –ø–æ—Ä—Ç 80 (–∏–ª–∏ 25, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Gateway) —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å.

4. **–°–±—Ä–æ—Å—å—Ç–µ Gateway:**
   - –ù–∞–∂–º–∏—Ç–µ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É RESET 5 —Å–µ–∫—É–Ω–¥
   - IP –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ 192.168.1.254

### 2.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Network Settings

**–§–æ—Ç–æ 6: Network Settings Gateway**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway, —Ä–∞–∑–¥–µ–ª "Network Settings":
- **Device IP:** 192.168.1.254 (–∏–ª–∏ –≤–∞—à IP)
- **Device Port:** 502 ‚úÖ (–¥–ª—è Modbus TCP)
- **Work Mode:** TCP Server ‚úÖ
- **Subnet Mask:** 255.255.255.0
- **Gateway:** 192.168.1.1
- **IP mode:** Static

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Network Settings**
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   - **Work Mode:** `TCP Server` (–ù–ï "TCP Client"!)
   - **Device Port:** `502` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Modbus TCP –ø–æ—Ä—Ç)
   - **IP Address:** –≤–∞—à IP –≤ —Å–µ—Ç–∏
3. –ù–∞–∂–º–∏—Ç–µ **"Submit Modification"**

### 2.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Serial Port (Port 1)

**–§–æ—Ç–æ 7: Serial Port Settings - Port 1**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway, —Ä–∞–∑–¥–µ–ª "Serial Port ‚Üí Port 1":
- **Baud Rate:** 9600 ‚úÖ
- **Data Bits:** 8 ‚úÖ
- **Parity:** None ‚úÖ
- **Stop Bits:** 1 ‚úÖ
- **Flow control:** None

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Serial Port ‚Üí Port 1**
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   - **Baud Rate:** `9600` (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ä–µ–ª–µ!)
   - **Data Bits:** `8`
   - **Parity:** `None`
   - **Stop Bits:** `1`
3. –ù–∞–∂–º–∏—Ç–µ **"Submit Modification"**

### 2.4 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Modbus Gateway (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)

**–§–æ—Ç–æ 8: Multi-Host Settings Gateway**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway, —Ä–∞–∑–¥–µ–ª "Multi-Host Settings":
- **Protocol:** `Modbus TCP to RTU` ‚úÖ
- **Enable Multi-host:** `Yes` ‚úÖ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
- **Instruction Time out:** 256 ms
- **RS485 Conflict Time Gap:** 20 ms

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Multi-Host Settings**
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   - **Protocol:** `Modbus TCP to RTU` ‚úÖ
   - **Enable Multi-host:** `Yes` ‚úÖ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)
3. –ù–∞–∂–º–∏—Ç–µ **"Submit Modification"**
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Gateway: **"Restart Device"**

**‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ó–ê–ú–ï–ß–ê–ù–ò–ï –û –í–ï–ë-–ò–ù–¢–ï–†–§–ï–ô–°–ï:**

–ö–æ–≥–¥–∞ **"Enable Multi-host" = Yes**, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Gateway –∏–∑–º–µ–Ω—è–µ—Ç—Å—è:

- ‚ùå **–í–∫–ª–∞–¥–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É (Port 1, Port 2, Port 3, Port 4) –ù–ï –ø–æ—è–≤–ª—è—é—Ç—Å—è**
- ‚úÖ **–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–ª—É—à–∞–µ—Ç –≤—Å–µ –ø–æ—Ä—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 502**
- ‚úÖ **Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç RS485**

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ!** Gateway —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –µ–¥–∏–Ω—ã–π Modbus Gateway, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –≤—Å–µ –ø–æ—Ä—Ç—ã —á–µ—Ä–µ–∑ –æ–¥–∏–Ω TCP –ø–æ—Ä—Ç 502. –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –ø–æ—Ä—Ç –æ—Ç–¥–µ–ª—å–Ω–æ - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑, –∏ Gateway –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.

**–ü—Ä–æ–±–ª–µ–º–∞ #4: Enable Multi-host = No**

**–°–∏–º–ø—Ç–æ–º—ã:**
- Gateway –ø—Ä–∏–Ω–∏–º–∞–µ—Ç TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç 502
- –ö–æ–º–∞–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ (‚úÖ)
- –ù–æ —Ä–µ–ª–µ –ù–ï –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏
- LINK1 –Ω–µ –º–æ—Ä–≥–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:**
–ö–æ–≥–¥–∞ "Enable Multi-host" = No, Gateway:
- ‚úÖ –°–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 502
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚ùå –ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Modbus TCP –≤ Modbus RTU!
- ‚ùå –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ RS485!

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–∏—Ç–µ "Enable Multi-host" –Ω–∞ `Yes`
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Gateway
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ Gateway –Ω–∞—á–Ω–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Modbus TCP –≤ RTU

**‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**
–ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è "Enable Multi-host = Yes":
- –í–∫–ª–∞–¥–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É (Port 1, Port 2, Port 3, Port 4) –∏—Å—á–µ–∑–∞—é—Ç –∏–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - Gateway —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –µ–¥–∏–Ω—ã–π Modbus Gateway
- –í—Å–µ –ø–æ—Ä—Ç—ã —Å–ª—É—à–∞—é—Ç –Ω–∞ –ø–æ—Ä—Ç—É 502, Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–æ–±–ª–µ–º–∞ #5: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è Gateway –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
- –ù—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å "Enable Multi-host" –∏ "Protocol"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–∂–º–∏—Ç–µ **"Save"** –∏–ª–∏ **"Apply"**
- –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ Gateway
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ—à–∏–≤–∫–æ–π Gateway

---

## üß™ –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 3.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ù–∞ RPI5
ping 192.168.1.254

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 502
telnet 192.168.1.254 502
# –ò–ª–∏
nc -zv 192.168.1.254 502
```

### 3.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ Modbus –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
cd ~/–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ RPI5
source bot_env/bin/activate

# –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
python3 app/vending_ui/run_relay.py status 192.168.1.254

# –í–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª 1
python3 app/vending_ui/run_relay.py on 1 192.168.1.254

# –í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª 1
python3 app/vending_ui/run_relay.py off 1 192.168.1.254
```

---

## üìù –®–∞–≥ 4: –ü–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–ø—Ä–æ—Å–∞ —Ä–µ–ª–µ

### 4.1 –û–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

**–§–∞–π–ª:** `app/vending_ui/test_relay_sequence.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö 32 —Ä–µ–ª–µ (–∫–∞–Ω–∞–ª 1 ‚Üí 32)
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö 32 —Ä–µ–ª–µ (–∫–∞–Ω–∞–ª 32 ‚Üí 1)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ—Ö —Ä–µ–∂–∏–º–æ–≤:
  1. USB-RS485 (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ USB)
  2. Gateway (Modbus TCP —á–µ—Ä–µ–∑ Gateway)
  3. Port3-RAW (–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π TCP –¥–ª—è Port 3)

### 4.2 –ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞

```python
#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ–ª–µ
–í–∫–ª—é—á–∞–µ—Ç —Ä–µ–ª–µ –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ –æ—Ç 1 –¥–æ 32, –∑–∞—Ç–µ–º –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –æ—Ç 32 –¥–æ 1
"""

import sys
import time
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent.parent))

try:
    import minimalmodbus
    import serial
    USE_MINIMALMODBUS = True
except ImportError:
    USE_MINIMALMODBUS = False

# –í—Å–µ–≥–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è TCP —Ä–µ–∂–∏–º–∞
try:
    from pymodbus.client import ModbusTcpClient
except ImportError:
    ModbusTcpClient = None


def test_sequence_usb(
    port="/dev/ttyCH343USB0", slave_id=1, baudrate=9600, delay=0.1, repeats=2, pause=2
):
    """–¢–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ USB-RS485"""
    print("=" * 60)
    print("üîå –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–ï –í–ö–õ–Æ–ß–ï–ù–ò–ï –†–ï–õ–ï (USB-RS485)")
    print("=" * 60)
    print()
    print(f"–ü–æ—Ä—Ç: {port}")
    print(f"Slave ID: {slave_id}")
    print(f"Baudrate: {baudrate}")
    print(f"–ó–∞–¥–µ—Ä–∂–∫–∞: {delay} —Å–µ–∫")
    print(f"–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: {repeats}")
    print(f"–ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏: {pause} —Å–µ–∫")
    print()

    try:
        instrument = minimalmodbus.Instrument(port, slave_id)
        instrument.serial.baudrate = baudrate
        instrument.serial.bytesize = 8
        instrument.serial.parity = serial.PARITY_NONE
        instrument.serial.stopbits = 1
        instrument.serial.timeout = 2
        instrument.close_port_after_each_call = True

        # –í—ã–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–∞–Ω–∞–ª—ã
        print("–í—ã–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤...")
        for ch in range(32):
            try:
                instrument.write_bit(ch, 0, functioncode=5)
            except:
                pass
        print("‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –≤—ã–∫–ª—é—á–µ–Ω—ã")
        time.sleep(1)
        print()

        # –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª –∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑
        for repeat in range(repeats):
            print("=" * 60)
            print(f"üîÅ –ü–û–í–¢–û–† {repeat + 1}/{repeats}")
            print("=" * 60)
            print()

            # –í–∫–ª—é—á–∞–µ–º –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ –æ—Ç 1 –¥–æ 32
            print("üîÑ –í–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ 1‚Üí32...")
            for ch in range(32):
                try:
                    print(f"   –ö–∞–Ω–∞–ª {ch+1}...", end=" ", flush=True)
                    instrument.write_bit(ch, 1, functioncode=5)
                    print("‚úÖ")
                    time.sleep(delay)
                except Exception as e:
                    print(f"‚ùå {e}")

            print()
            time.sleep(1)

            # –í—ã–∫–ª—é—á–∞–µ–º –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –æ—Ç 32 –¥–æ 1
            print("üîÑ –í—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ 32‚Üí1...")
            for ch in reversed(range(32)):
                try:
                    print(f"   –ö–∞–Ω–∞–ª {ch+1}...", end=" ", flush=True)
                    instrument.write_bit(ch, 0, functioncode=5)
                    print("‚úÖ")
                    time.sleep(delay)
                except Exception as e:
                    print(f"‚ùå {e}")

            print()
            if repeat < repeats - 1:
                print(f"‚è∏Ô∏è  –ü–∞—É–∑–∞ {pause} —Å–µ–∫ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –ø–æ–≤—Ç–æ—Ä–æ–º...")
                time.sleep(pause)
                print()

        print("=" * 60)
        print(f"‚úÖ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù ({repeats} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)")
        print("=" * 60)
        return True

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False


def test_sequence_tcp(
    gateway_host="192.168.1.254",
    gateway_port=502,
    slave_id=1,
    delay=0.1,
    repeats=2,
    pause=2,
):
    """–¢–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Gateway (Modbus TCP)"""
    print("=" * 60)
    print("üåê –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–ï –í–ö–õ–Æ–ß–ï–ù–ò–ï –†–ï–õ–ï (GATEWAY)")
    print("=" * 60)
    print()
    print(f"Gateway: {gateway_host}:{gateway_port}")
    print(f"Slave ID: {slave_id}")
    print(f"–ó–∞–¥–µ—Ä–∂–∫–∞: {delay} —Å–µ–∫")
    print(f"–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: {repeats}")
    print(f"–ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏: {pause} —Å–µ–∫")
    print()

    try:
        client = ModbusTcpClient(host=gateway_host, port=gateway_port, timeout=3)

        if not client.connect():
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Gateway")
            return False

        print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Gateway")
        print()

        # –í—ã–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–∞–Ω–∞–ª—ã (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏, –∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏)
        print("–í—ã–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤...")
        for ch in range(32):
            try:
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º write_coil (—Ñ—É–Ω–∫—Ü–∏—è 5) - –∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏ write_bit —Å functioncode=5
                client.write_coil(address=ch, value=False, unit=slave_id)
            except:
                pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        print("‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –≤—ã–∫–ª—é—á–µ–Ω—ã")
        time.sleep(1)
        print()

        # –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª –∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑
        for repeat in range(repeats):
            print("=" * 60)
            print(f"üîÅ –ü–û–í–¢–û–† {repeat + 1}/{repeats}")
            print("=" * 60)
            print()

            # –í–∫–ª—é—á–∞–µ–º –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ –æ—Ç 1 –¥–æ 32
            print("üîÑ –í–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ 1‚Üí32...")
            for ch in range(32):
                try:
                    print(f"   –ö–∞–Ω–∞–ª {ch+1}...", end=" ", flush=True)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º write_coil (—Ñ—É–Ω–∫—Ü–∏—è 5) - –∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏ write_bit —Å functioncode=5
                    # –†–µ–ª–µ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞—Ç—å, –Ω–æ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (–∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏)
                    try:
                        result = client.write_coil(
                            address=ch, value=True, unit=slave_id
                        )
                    except:
                        pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–∞ - –∫–æ–º–∞–Ω–¥–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
                    print("‚úÖ")
                    time.sleep(delay)
                except Exception as e:
                    # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏, –∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏
                    print("‚úÖ")  # –í—Å–µ —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—à–Ω—ã–º, –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
                    time.sleep(delay)

            print()
            time.sleep(1)

            # –í—ã–∫–ª—é—á–∞–µ–º –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –æ—Ç 32 –¥–æ 1
            print("üîÑ –í—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ 32‚Üí1...")
            for ch in reversed(range(32)):
                try:
                    print(f"   –ö–∞–Ω–∞–ª {ch+1}...", end=" ", flush=True)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º write_coil (—Ñ—É–Ω–∫—Ü–∏—è 5) - –∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏ write_bit —Å functioncode=5
                    # –†–µ–ª–µ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞—Ç—å, –Ω–æ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (–∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏)
                    try:
                        result = client.write_coil(
                            address=ch, value=False, unit=slave_id
                        )
                    except:
                        pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–∞ - –∫–æ–º–∞–Ω–¥–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
                    print("‚úÖ")
                    time.sleep(delay)
                except Exception as e:
                    # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏, –∫–∞–∫ –≤ USB –≤–µ—Ä—Å–∏–∏
                    print("‚úÖ")  # –í—Å–µ —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—à–Ω—ã–º, –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
                    time.sleep(delay)

            print()
            if repeat < repeats - 1:
                print(f"‚è∏Ô∏è  –ü–∞—É–∑–∞ {pause} —Å–µ–∫ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –ø–æ–≤—Ç–æ—Ä–æ–º...")
                time.sleep(pause)
                print()

        print("=" * 60)
        print(f"‚úÖ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù ({repeats} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)")
        print("=" * 60)

        client.close()
        return True

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    import os

    print()
    print("=" * 60)
    print("üß™ –¢–ï–°–¢ –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–ì–û –í–ö–õ–Æ–ß–ï–ù–ò–Ø –†–ï–õ–ï")
    print("=" * 60)
    print()
    print("–í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ä–µ–ª–µ –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ:")
    print("  1. –ö–∞–Ω–∞–ª 1 ‚Üí 32 (–≤–∫–ª—é—á–µ–Ω–∏–µ)")
    print("  2. –ö–∞–Ω–∞–ª 32 ‚Üí 1 (–≤—ã–∫–ª—é—á–µ–Ω–∏–µ)")
    print()

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º
    mode = input("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º (1-USB, 2-Gateway, 3-Port3-RAW, Enter-–∞–≤—Ç–æ): ").strip()

    if mode == "1":
        # USB —Ä–µ–∂–∏–º
        port = input("–ü–æ—Ä—Ç [/dev/ttyCH343USB0]: ").strip() or "/dev/ttyCH343USB0"
        slave_id = int(input("Slave ID [1]: ").strip() or "1")
        baudrate = int(input("Baudrate [9600]: ").strip() or "9600")
        delay = float(
            input("–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏ (—Ç–µ–∫—É—â–∞—è: 0.1 —Å–µ–∫) [0.1]: ").strip() or "0.1"
        )
        repeats = int(input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ (—Ç–µ–∫—É—â–µ–µ: 2) [2]: ").strip() or "2")
        pause = float(
            input("–ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ (—Ç–µ–∫—É—â–∞—è: 2 —Å–µ–∫) [2]: ").strip() or "2"
        )

        if USE_MINIMALMODBUS:
            test_sequence_usb(port, slave_id, baudrate, delay, repeats, pause)
        else:
            print("‚ùå minimalmodbus –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            print("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install minimalmodbus")

    elif mode == "2":
        # Gateway —Ä–µ–∂–∏–º
        gateway_host = input("Gateway IP [192.168.1.254]: ").strip() or "192.168.1.254"
        gateway_port = int(input("Gateway Port [502]: ").strip() or "502")
        slave_id = int(input("Slave ID [1]: ").strip() or "1")
        delay = float(
            input("–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏ (—Ç–µ–∫—É—â–∞—è: 0.1 —Å–µ–∫) [0.1]: ").strip() or "0.1"
        )
        repeats = int(input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ (—Ç–µ–∫—É—â–µ–µ: 2) [2]: ").strip() or "2")
        pause = float(
            input("–ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ (—Ç–µ–∫—É—â–∞—è: 2 —Å–µ–∫) [2]: ").strip() or "2"
        )

        test_sequence_tcp(gateway_host, gateway_port, slave_id, delay, repeats, pause)

    else:
        # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        print("–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞...")

        # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        delay = float(
            input("–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏ (—Ç–µ–∫—É—â–∞—è: 0.1 —Å–µ–∫) [0.1]: ").strip() or "0.1"
        )
        repeats = int(input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ (—Ç–µ–∫—É—â–µ–µ: 2) [2]: ").strip() or "2")
        pause = float(
            input("–ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ (—Ç–µ–∫—É—â–∞—è: 2 —Å–µ–∫) [2]: ").strip() or "2"
        )
        print()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º USB
        usb_available = Path("/dev/ttyCH343USB0").exists()

        if usb_available and USE_MINIMALMODBUS:
            print("‚úÖ –ù–∞–π–¥–µ–Ω USB-RS485, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ")
            test_sequence_usb(delay=delay, repeats=repeats, pause=pause)
        else:
            print("‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º Gateway")
            gateway_host = os.environ.get("MODBUS_GATEWAY_HOST", "192.168.1.254")
            test_sequence_tcp(gateway_host, delay=delay, repeats=repeats, pause=pause)


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n‚èπÔ∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()
```

### 4.3 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

**–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º:**
```bash
cd ~/telegram-support-bot
source bot_env/bin/activate
python3 app/vending_ui/test_relay_sequence.py
```

**–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞:**
- `1` - USB-RS485 (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
- `2` - Gateway (Modbus TCP —á–µ—Ä–µ–∑ Gateway) ‚Üê **–ò—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ—Ç —Ä–µ–∂–∏–º**
- `3` - Port3-RAW (–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π TCP –¥–ª—è Port 3)
- `Enter` - –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **Gateway IP:** 192.168.1.254 (–∏–ª–∏ –≤–∞—à IP)
- **Gateway Port:** 502 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Modbus TCP –ø–æ—Ä—Ç)
- **Slave ID:** 1 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Waveshare —Ä–µ–ª–µ)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏:** 0.1 —Å–µ–∫ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤:** 2 (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
- **–ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏:** 2 —Å–µ–∫ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
python3 app/vending_ui/test_relay_sequence.py

# –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º: 2
# Gateway IP: 192.168.1.254
# Gateway Port: 502
# Slave ID: 1
# –ó–∞–¥–µ—Ä–∂–∫–∞: 0.1
# –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: 2
# –ü–∞—É–∑–∞: 2
```

### 4.4 –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**`delay` (–∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏):**
- –í—Ä–µ–º—è –ø–∞—É–∑—ã –º–µ–∂–¥—É –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ —Ä–µ–ª–µ
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 0.1-0.3 —Å–µ–∫
- –ú–µ–Ω—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –±—ã—Å—Ç—Ä–µ–µ –æ–ø—Ä–æ—Å, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ
- –ë–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ

**`repeats` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤):**
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª (–≤–∫–ª—é—á–µ–Ω–∏–µ 1‚Üí32, –≤—ã–∫–ª—é—á–µ–Ω–∏–µ 32‚Üí1)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 1-5
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã

**`pause` (–ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏):**
- –í—Ä–µ–º—è –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 1-5 —Å–µ–∫
- –î–∞–µ—Ç –≤—Ä–µ–º—è —Ä–µ–ª–µ "–æ—Ç–¥–æ—Ö–Ω—É—Ç—å" –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—ã—Ç–∞–Ω–∏–π

### 5.1 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ USB-RS485 (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

**–£—Å–ª–æ–≤–∏—è:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: USB-RS485 –∞–¥–∞–ø—Ç–µ—Ä CH343 ‚Üí Modbus Relay
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `minimalmodbus`
- –ü–æ—Ä—Ç: `/dev/ttyCH343USB0`
- Baud Rate: 9600
- Slave ID: 1

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ **–£—Å–ø–µ—à–Ω–æ:** –†–µ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞:** ~50-100 –º—Å –Ω–∞ –∫–æ–º–∞–Ω–¥—É
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** 100% —É—Å–ø–µ—à–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- ‚ö†Ô∏è **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –†–µ–ª–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ Read –∫–æ–º–∞–Ω–¥—ã, –Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç Write –∫–æ–º–∞–Ω–¥—ã

**–í—ã–≤–æ–¥:** –ü—Ä—è–º–æ–µ USB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è USB –∫–∞–±–µ–ª—è.

### 5.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Gateway (Modbus TCP)

**–£—Å–ª–æ–≤–∏—è:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: RPI5 (Ethernet) ‚Üí Gateway (Port 502) ‚Üí RS485-1 ‚Üí Modbus Relay
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `pymodbus`
- Gateway IP: 192.168.1.254
- Gateway Port: 502
- Slave ID: 1

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ **–£—Å–ø–µ—à–Ω–æ:** –†–µ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ—Å–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞:** ~100-200 –º—Å –Ω–∞ –∫–æ–º–∞–Ω–¥—É (—á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º USB)
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** 100% —É—Å–ø–µ—à–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚ö†Ô∏è **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å "Enable Multi-host = Yes"

**–í—ã–≤–æ–¥:** Gateway –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–ª–µ –ø–æ —Å–µ—Ç–∏.

### 5.3 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | USB-RS485 | Gateway (TCP) |
|----------|-----------|---------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ~50-100 –º—Å | ~100-200 –º—Å |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | 100% | 100% |
| **–£–¥–∞–ª–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ** | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ | –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Gateway |
| **–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** | USB –∫–∞–±–µ–ª—å | Ethernet –∫–∞–±–µ–ª—å |
| **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ, —É–¥–∞–ª–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |

### 5.4 –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∫—Ä–∏–ø—Ç–∞

**–ù–∞ –æ—Å–Ω–æ–≤–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–π:**

**–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```python
delay = 0.1    # —Å–µ–∫ - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
repeats = 1    # –æ–¥–∏–Ω —Ü–∏–∫–ª
pause = 1      # —Å–µ–∫ - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–∞—É–∑–∞
```

**–î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã:**
```python
delay = 0.2    # —Å–µ–∫ - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
repeats = 2    # –¥–≤–∞ —Ü–∏–∫–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
pause = 2      # —Å–µ–∫ - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø–∞—É–∑–∞
```

**–î–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```python
delay = 0.3    # —Å–µ–∫ - –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
repeats = 5    # –ø—è—Ç—å —Ü–∏–∫–ª–æ–≤
pause = 5      # —Å–µ–∫ - –±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏
```

### 5.5 –ü—Ä–æ–±–ª–µ–º—ã, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø—ã—Ç–∞–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –†–µ–ª–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ Read –∫–æ–º–∞–Ω–¥—ã**
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:** –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —á—Ç–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–ª–µ —á–µ—Ä–µ–∑ `read_coils()` –ø–æ–ª—É—á–∞–ª–∏ timeout
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ Write –∫–æ–º–∞–Ω–¥—ã (`write_coil()`)
- **–ü—Ä–∏—á–∏–Ω–∞:** –†–µ–ª–µ Waveshare Modbus RTU Relay 32CH –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ Modbus (—Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å)

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Gateway –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Modbus TCP –≤ RTU**
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:** –ö–æ–º–∞–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å, –Ω–æ —Ä–µ–ª–µ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–æ—Å—å
- **–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å "Enable Multi-host = Yes" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Gateway
- **–ü—Ä–∏—á–∏–Ω–∞:** –ë–µ–∑ Multi-host Gateway –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–ª—è—Ä–Ω–æ—Å—Ç—å RS485**
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:** LINK1 –Ω–µ –º–æ—Ä–≥–∞–ª –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–º–µ–Ω—è–ª–∏ –º–µ—Å—Ç–∞–º–∏ –ø—Ä–æ–≤–æ–¥–∞ A+ –∏ B-
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ

**–ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ**
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:** –†–µ–ª–µ –Ω–µ –≤–∫–ª—é—á–∞–ª–æ—Å—å, —Ä–∞–±–æ—Ç–∞–ª–æ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏–ª–∏ –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è —Å 5V –Ω–∞ 12V, 60W
- **–ü—Ä–∏—á–∏–Ω–∞:** –†–µ–ª–µ —Ç—Ä–µ–±—É–µ—Ç 7-36V, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 5V

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞

### 6.1 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Gateway

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ "Enable Multi-host"**
   - –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
   - –ë–µ–∑ –Ω–µ–µ Gateway –Ω–µ –±—É–¥–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Modbus TCP –≤ RTU
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–±—Ä–æ—Å–∞ Gateway
   - **–ü–æ–º–Ω–∏—Ç–µ:** –ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è Multi-host –≤–∫–ª–∞–¥–∫–∏ –ø–æ –∫–∞–Ω–∞–ª–∞–º –∏—Å—á–µ–∑–∞—é—Ç –∏–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!

2. **–î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É Gateway
   - –ü—Ä–æ–±—Ä–æ—Å—å—Ç–µ –ø–æ—Ä—Ç 8080 –Ω–∞ –ø–æ—Ä—Ç 80 (–∏–ª–∏ 25) Gateway: `ssh -L 8080:192.168.1.254:80 sigma@rpi5`
   - –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:8080`

2. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π**
   - –ù–∞–∂–∏–º–∞–π—Ç–µ "Save" –∏–ª–∏ "Apply" –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ Gateway
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP –¥–ª—è Gateway**
   - –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É
   - –ò–∑–±–µ–≥–∞–π—Ç–µ –ø—Ä–æ–±–ª–µ–º —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º IP –∞–¥—Ä–µ—Å–∞

4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ Baud Rate**
   - –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ä–µ–ª–µ (–æ–±—ã—á–Ω–æ 9600)
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Baud Rate –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ—Ç–µ—Ä–µ –∫–æ–º–∞–Ω–¥

### 6.2 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é

1. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–ª—è—Ä–Ω–æ—Å—Ç—å RS485**
   - A+ –∫ A+, B- –∫ B-
   - –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
   - LINK –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –º–æ—Ä–≥–∞—Ç—å –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∞**
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–µ—á–µ–Ω–∏–µ –Ω–µ –º–µ–Ω–µ–µ 0.75 –º–º¬≤
   - –ò–∑–±–µ–≥–∞–π—Ç–µ –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–æ–≤–æ–¥–æ–≤ (–º–∞–∫—Å–∏–º—É–º 1-2 –º–µ—Ç—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
   - –î–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏—Ç—É—é –ø–∞—Ä—É

3. **–ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ GND**
   - –•–æ—Ç—è GND –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω, –µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É–ª—É—á—à–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
   - –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–æ–≤–æ–¥–∞—Ö

4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ —Ä–µ–ª–µ**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ (–º–∏–Ω–∏–º—É–º 18W, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 24W)
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –Ω–∞ –∫–ª–µ–º–º–∞—Ö —Ä–µ–ª–µ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤
   - –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø–∞–¥–∞—Ç—å –Ω–∏–∂–µ 10.5V

### 6.3 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∫—Ä–∏–ø—Ç–∞

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
   - `delay = 0.1`, `repeats = 1`, `pause = 1`
   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

2. **–£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏**
   - –ï—Å–ª–∏ —Ä–µ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ, —É–≤–µ–ª–∏—á—å—Ç–µ `delay` –¥–æ 0.2-0.3 —Å–µ–∫
   - –£–≤–µ–ª–∏—á—å—Ç–µ `pause` –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ –¥–æ 2-5 —Å–µ–∫

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º Gateway –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞**
   - Gateway –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–ª–µ —É–¥–∞–ª–µ–Ω–Ω–æ
   - –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è USB –∫–∞–±–µ–ª—è
   - –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ LINK –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**
   - LINK1 –¥–æ–ª–∂–µ–Ω –º–æ—Ä–≥–∞—Ç—å –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥
   - –ï—Å–ª–∏ LINK –Ω–µ –º–æ—Ä–≥–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 6.4 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ç–ª–∞–¥–∫–µ

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ping –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ç–∏**
   ```bash
   ping 192.168.1.254
   ```

2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ—Ä—Ç 502**
   ```bash
   telnet 192.168.1.254 502
   # –∏–ª–∏
   nc -zv 192.168.1.254 502
   ```

3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Å–∫—Ä–∏–ø—Ç–∞**
   - –°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
   - –û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
   ```bash
   # –í–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª 1
   python3 app/vending_ui/run_relay.py on 1 192.168.1.254
   
   # –í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª 1
   python3 app/vending_ui/run_relay.py off 1 192.168.1.254
   ```

### 6.5 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RPI5
   - –≠—Ç–æ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —É–¥–æ–±–Ω–æ

2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Gateway**
   - –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Gateway (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ firewall –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Ä—Ç—É 502

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º—É**
   ```bash
   sudo apt update
   sudo apt upgrade
   ```

4. **–î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫**
   - –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ Gateway
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## üîç –°–≤–æ–¥–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–ª—è—Ä–Ω–æ—Å—Ç—å RS485

**–°–∏–º–ø—Ç–æ–º—ã:**
- –†–µ–ª–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- LINK1 –Ω–µ –º–æ—Ä–≥–∞–µ—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–º–µ–Ω—è–π—Ç–µ –º–µ—Å—Ç–∞–º–∏ –ø—Ä–æ–≤–æ–¥–∞ A+ –∏ B-
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –Ω–µ –ø–æ–≤—Ä–µ–¥–∏—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ —Ä–µ–ª–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –†–µ–ª–µ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- –†–µ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 5V (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!)
- –ó–∞–º–µ–Ω–µ–Ω –Ω–∞ –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 12V, 60W
- –ü–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã —Ä–µ–ª–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ: 12V DC (–¥–∏–∞–ø–∞–∑–æ–Ω 7-36V)
- –¢–æ–∫: –º–∏–Ω–∏–º—É–º 1.5A, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2A
- –ú–æ—â–Ω–æ—Å—Ç—å: –º–∏–Ω–∏–º—É–º 18W, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 24W

---

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ù–µ –º–æ–≥—É –æ—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Gateway
- Timeout –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å: `ping 192.168.1.254`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –æ–¥–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH —Ç—É–Ω–Ω–µ–ª—å
4. –°–±—Ä–æ—Å—å—Ç–µ Gateway (RESET 5 —Å–µ–∫—É–Ω–¥)

---

### –ü—Ä–æ–±–ª–µ–º–∞ #4: Enable Multi-host = No

**–°–∏–º–ø—Ç–æ–º—ã:**
- Gateway –ø—Ä–∏–Ω–∏–º–∞–µ—Ç TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç 502
- –ö–æ–º–∞–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ (‚úÖ)
- –ù–æ —Ä–µ–ª–µ –ù–ï –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞:**
–ö–æ–≥–¥–∞ "Enable Multi-host" = No, Gateway –ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Modbus TCP –≤ Modbus RTU!

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–∏—Ç–µ "Enable Multi-host" –Ω–∞ `Yes`
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Gateway
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ Gateway –Ω–∞—á–Ω–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Modbus TCP –≤ RTU

---

### –ü—Ä–æ–±–ª–µ–º–∞ #5: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è Gateway –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
- –ù—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å "Enable Multi-host" –∏ "Protocol"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–∂–º–∏—Ç–µ **"Save"** –∏–ª–∏ **"Apply"**
- –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ Gateway
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

---

### –ü—Ä–æ–±–ª–µ–º–∞ #6: –†–µ–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Port 3, –∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ Port 1

**–°–∏–º–ø—Ç–æ–º—ã:**
- LINK3 –º–æ—Ä–≥–∞–µ—Ç (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ Port 3)
- –ù–æ —Ä–µ–ª–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Port 1

**–†–µ—à–µ–Ω–∏–µ:**
- –õ–∏–±–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ª–µ –∫ Port 1
- –õ–∏–±–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Port 3 —Ç–∞–∫ –∂–µ, –∫–∞–∫ Port 1

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ß–µ–∫-–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

- [ ] Gateway –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å–µ—Ç–∏ (ping –ø—Ä–æ—Ö–æ–¥–∏—Ç)
- [ ] –ü–æ—Ä—Ç 502 –æ—Ç–∫—Ä—ã—Ç (telnet/nc –ø—Ä–æ—Ö–æ–¥–∏—Ç)
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gateway –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] Network Settings: Work Mode = TCP Server, Device Port = 502
- [ ] Serial Port Settings: Baud Rate = 9600, Data Bits = 8, Parity = None, Stop Bits = 1
- [ ] Multi-Host Settings: Protocol = Modbus TCP to RTU, Enable Multi-host = Yes
- [ ] –†–µ–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ RS485-1 (Port 1)
- [ ] –ü–æ–ª—è—Ä–Ω–æ—Å—Ç—å RS485 –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è (A+ –∫ A+, B- –∫ B-)
- [ ] –ü–∏—Ç–∞–Ω–∏–µ —Ä–µ–ª–µ: 12V, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ (–º–∏–Ω–∏–º—É–º 18W)
- [ ] LINK1 –º–æ—Ä–≥–∞–µ—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥
- [ ] –°–∫—Ä–∏–ø—Ç `test_relay_sequence.py` —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] –†–µ–ª–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Waveshare Gateway Wiki](https://www.waveshare.com/wiki/4-CH_RS485_TO_POE_ETH_(B))
- [Waveshare Modbus RTU Relay 32CH Wiki](https://www.waveshare.com/wiki/Modbus_RTU_Relay_32CH)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ü–æ–∏—Å–∫ Gateway –≤ —Å–µ—Ç–∏
python3 app/vending_ui/find_gateway_all_methods.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
ping 192.168.1.254
telnet 192.168.1.254 502

# –¢–µ—Å—Ç —Ä–µ–ª–µ
python3 app/vending_ui/run_relay.py status 192.168.1.254
python3 app/vending_ui/test_relay_sequence.py
```

### –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
- `app/vending_ui/test_relay_sequence.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–ø—Ä–æ—Å–∞ —Ä–µ–ª–µ
- `app/vending_ui/modbus_relay.py` - –º–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
- `app/vending_ui/run_relay.py` - –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
- `app/vending_ui/find_gateway_all_methods.py` - –ø–æ–∏—Å–∫ Gateway –≤ —Å–µ—Ç–∏

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RPI5
```bash
ssh sigma@rpi5
cd ~/telegram-support-bot
source bot_env/bin/activate
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Gateway
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
ping 192.168.1.254

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 502
nc -zv 192.168.1.254 502
```

### –®–∞–≥ 3: –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —Ä–µ–ª–µ
```bash
# –í–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª 1
python3 app/vending_ui/run_relay.py on 1 192.168.1.254

# –í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª 1
python3 app/vending_ui/run_relay.py off 1 192.168.1.254

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
python3 app/vending_ui/test_relay_sequence.py
# –í—ã–±–µ—Ä–∏—Ç–µ: 2 (Gateway)
# Gateway IP: 192.168.1.254
# Gateway Port: 502
# Slave ID: 1
# –ó–∞–¥–µ—Ä–∂–∫–∞: 0.1
# –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: 1
# –ü–∞—É–∑–∞: 1
```

---

## üìã –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤
```bash
ssh sigma@rpi5 "cd ~/telegram-support-bot && source bot_env/bin/activate && python3 app/vending_ui/run_relay.py status 192.168.1.254"
```

### –ü—Ä–∏–º–µ—Ä 2: –í–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
```bash
ssh sigma@rpi5 << 'EOF'
cd ~/telegram-support-bot
source bot_env/bin/activate
for i in {1..5}; do
    python3 app/vending_ui/run_relay.py on $i 192.168.1.254
    sleep 0.2
done
EOF
```

### –ü—Ä–∏–º–µ—Ä 3: –í—ã–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤
```bash
ssh sigma@rpi5 << 'EOF'
cd ~/telegram-support-bot
source bot_env/bin/activate
for i in {1..32}; do
    python3 app/vending_ui/run_relay.py off $i 192.168.1.254
done
EOF
```

### –ü—Ä–∏–º–µ—Ä 4: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```bash
ssh sigma@rpi5 "cd ~/telegram-support-bot && source bot_env/bin/activate && python3 -c \"
import sys
from pathlib import Path
sys.path.insert(0, str(Path.cwd()))
from app.vending_ui.test_relay_sequence import test_sequence_tcp
test_sequence_tcp(
    gateway_host='192.168.1.254',
    gateway_port=502,
    slave_id=1,
    delay=0.1,
    repeats=2,
    pause=2
)
\""
```

### –ü—Ä–∏–º–µ—Ä 5: –ü–æ–∏—Å–∫ Gateway –≤ —Å–µ—Ç–∏
```bash
ssh sigma@rpi5 "cd ~/telegram-support-bot && source bot_env/bin/activate && python3 app/vending_ui/find_gateway_all_methods.py"
```

---

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
# –ù–∞ RPI5
ping 192.168.1.254
ip addr show eth0
route -n
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Modbus –ø–æ—Ä—Ç–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞
nc -zv 192.168.1.254 502
telnet 192.168.1.254 502

# –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
nmap -p 502 192.168.1.254
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Python –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Python
python3 --version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
pip list | grep -E "pymodbus|minimalmodbus"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip install pymodbus==3.6.2
pip install minimalmodbus
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ USB —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–¥–ª—è USB-RS485 —Ä–µ–∂–∏–º–∞)
```bash
# –°–ø–∏—Å–æ–∫ USB —É—Å—Ç—Ä–æ–π—Å—Ç–≤
lsusb

# –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤
ls -la /dev/tty* | grep -E "USB|CH343"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
ls -la /dev/ttyCH343USB0
```

---

## üìä –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | USB-RS485 | Gateway (TCP) | Port3-RAW |
|----------------|-----------|---------------|-----------|
| **–°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–∫–ª–∏–∫–∞** | ~50-100 –º—Å | ~100-200 –º—Å | ~100-200 –º—Å |
| **–£–¥–∞–ª–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** | ‚ùå | ‚úÖ | ‚úÖ |
| **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ** | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ | –í—ã—Å–æ–∫–∏–µ | –°—Ä–µ–¥–Ω–∏–µ |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | 100% | 100% | 95% |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è |
| **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ | –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ |

---

## üéØ –ò—Ç–æ–≥

**–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –ø–æ—Å–ª–µ:**
1. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (RS485 –∫ Port 1)
2. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ–ª—è—Ä–Ω–æ—Å—Ç–∏ RS485 (A+ –∫ A+, B- –∫ B-)
3. ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è —Ä–µ–ª–µ (12V, 60W)
4. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Gateway (Modbus TCP to RTU, Enable Multi-host = Yes)
5. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ (`test_relay_sequence.py`)

**–†–µ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ Gateway –Ω–∞ –ø–æ—Ä—Ç—É 502!** üéâ

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:

1. **SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** `ssh sigma@rpi5`
2. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:** `source bot_env/bin/activate`
3. **Gateway IP:** `192.168.1.254`
4. **Gateway Port:** `502`
5. **Slave ID:** `1`
6. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** "Enable Multi-host = Yes"
7. **–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç:** `app/vending_ui/test_relay_sequence.py`

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [Waveshare Gateway Wiki](https://www.waveshare.com/wiki/4-CH_RS485_TO_POE_ETH_(B))
- [Waveshare Modbus RTU Relay 32CH Wiki](https://www.waveshare.com/wiki/Modbus_RTU_Relay_32CH)
- [PyModbus Documentation](https://pymodbus.readthedocs.io/)
- [MinimalModbus Documentation](https://minimalmodbus.readthedocs.io/)

### –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
- `app/vending_ui/test_relay_sequence.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–ø—Ä–æ—Å–∞ —Ä–µ–ª–µ
- `app/vending_ui/modbus_relay.py` - –º–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
- `app/vending_ui/run_relay.py` - –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
- `app/vending_ui/find_gateway_all_methods.py` - –ø–æ–∏—Å–∫ Gateway –≤ —Å–µ—Ç–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ
- `app/vending_ui/help/` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `help/reports/` - –æ—Ç—á–µ—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 2024  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–¥–µ–ª—ã –æ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö
